<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="icon" type="image/png" href="images/fav.png" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Light queries that any user can execute to extract informations">
  <meta name="author" content="Abdellah Sabry">
  <title>Instagram Application</title>
  <!-- Bootstrap core CSS-->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom fonts for this template-->
  <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <!-- Page level plugin CSS-->
  <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
  <!-- Custom styles for this template-->
  <link href="css/style.css" rel="stylesheet">
  <!--charts -->
  <!-- <script type="text/javascript" src="js/canvasjs-2.0/canvasjs.min.js"></script> -->
  <script src="vendor/chart.js/Chart.min.js"></script>
</head>

<body class="fixed-nav sticky-footer bg-dark" id="page-top">
  <!-- Navigation, on touche plus-->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <a class="navbar-brand" href="/">Instagram Database</a>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Users">
          <a class="nav-link" href="/users">
            <i class="fa fa-fw fa-table"></i>
            <span class="nav-link-text">Users page</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Analyst">
          <a class="nav-link" href="/analyst">
            <i class="fa fa-fw fa-area-chart"></i>
            <span class="nav-link-text">Analyst page</span>
          </a>
        </li>
        <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Admin">
          <a class="nav-link" href="/">
            <i class="fa fa-fw fa-table"></i>
            <span class="nav-link-text">Admin page</span>
          </a>
        </li>
      </ul> <!--menu avec les choix qu'on a -->
      <ul class="navbar-nav sidenav-toggler"> <!-- toggle button en bas de la page -->
        <li class="nav-item">
          <a class="nav-link text-center" id="sidenavToggler">
            <i class="fa fa-fw fa-angle-left"></i>
          </a>
        </li>
      </ul>
      <ul class="navbar-nav ml-auto">
        <img width="55px" height="42px" src="images/logo.png">
      </ul>  <!-- instagram logo en haut a droite -->
    </div>
  </nav>
  <div class="content-wrapper">
    <div class="container-fluid">
      <!-- Breadcrumbs-->
      <ol class="breadcrumb">
        <li class="breadcrumb-item active">Users</li>
      </ol>
      <hr class="sep">
      <!-- create the query here-->
      <div class="card mb-3">
          <div class="card-header">QUERY</div>
          <div class="card-body">
            <p> You may filter users with some basic filter in this form. For more complex queries, please refer to the dropbox in the second section below. </p>
            <h6><i> Instagramer informations</i> </h6>
            <form action="/users" method="post">
              <div class="form-row">
                <div class="form-group col-md-3">
                  <label for="country">User's country</label>
                  <input type="text" class="form-control" name="country" id="country" placeholder="France">
                </div>
                <div class="form-group col-md-2">
                  <label for="nbCountry">Number of user visited country</label>
                  <input type="text" class="form-control" name="nbCountry" id="nbCountry" placeholder="2">
                </div>
                <div class="form-group col-md-2">
                  <label for="totImgs">Number of user's total images</label>
                  <input type="text" class="form-control" name="totImgs" id="totImgs" placeholder="10">
                </div>
                <div class="form-group col-md-2">
                  <label for="junImgs">Number of user's June images</label>
                  <input type="text" class="form-control" name="junImgs" id="junImgs" placeholder="3">
                </div>
                <div class="form-group col-md-3">
                  <label for="visitedName">Location's name user have visited at least once</label>
                  <input type="text" class="form-control" name="visitedName" id="visitedName" placeholder="Fontaine des Innocents">
                </div>

              </div>
              <hr>
              <h6><i> Instagramer's june photographies (having at least one that match with filters) </i> </h6>
              <div class="form-row">
                <div class="form-group col-md-2">
                  <label for="address">Location's address</label>
                  <input type="text" class="form-control" name="address" id="address" placeholder="2 Route du Champ de Manoeuvre, Paris">
                </div>
                <div class="form-group col-md-2">
                  <label for="name">Location's name</label>
                  <input type="text" class="form-control" name="name" id="name" placeholder="Parc Floral de Paris">
                </div>
                <div class="form-group col-md-2">
                  <label for="date">Photography's date</label>
                  <input type="text" class="form-control" name="date" id="date" placeholder="2014-06-21 20:14:53">
                </div>
                <div class="form-group col-md-2">
                  <label for="coord">Photography's coordinates</label>
                  <input type="text" class="form-control" name="coord" id="coord" placeholder="48.8354904,2.4501494">
                </div>
                <div class="form-group col-md-1">
                  <label for="coord">Radius</label>
                  <input type="text" class="form-control" name="radius" id="radius" placeholder="200">
                </div>
                <div class="form-group col-md-2">
                  <label for="type">Monument type</label>
                  <input type="text" class="form-control" name="type" id="type" placeholder="point_of_interest">
                </div>
                <div class="form-group col-md-1">
                  <label for="rating">Rate (greater)</label>
                  <input type="text" class="form-control" name="rating" id="rating" placeholder="3.9">
                </div>
              </div>
              <div class="col text-center">
                  <button type="submit" class="btn btn-primary">Launch query</button>
              </div>
              </form>
          </div>
          <div class="card-footer small text-muted"> Table of <b>instagramers</b> having at least one match with filters.</div>
      </div>
      <hr class="sep">
      <div class="card mb-3">
          <div class="card-header">PREPARED QUERY</div>
          <div class="card-body">
              <p> This is the second section, where you can choose any of our prepared queries to execute. </p>
              <form action="/users" method="post">
                <div class="form-group">
                  <label for="query">Prepared queries:</label>
                  <select class="form-control" name="query" id="query" onchange="this.form.submit()">
                    <option value=''>None</option>
                    <option value=
                    '{
                        "agg":1,
                        "query": [
                        {"$group": { "_id": "$nationality", "nb":{"$sum":1}}},
                        {"$project": {"_id":0,"nationality": "$_id","count":"$nb"}},
                        {"$sort": { "count": -1}}
                        ]
                      }'
                      >Quelle est l'origine des utilisateurs les plus fr√©quent sur Paris au mois Juin 2014?</option>
                  </select>
                  <br>
                </div>
              </form>
          </div>
          <div class="card-footer small text-muted"> Table having <b>prepared queries</b> to be executed directly.</div>


      <!-- results of the query here-->
      <% if(queried==1){ %>
          <br>
          <hr class="sep">
          <% if(error!=null){%>
            <h6><font color="red"> <%= error %></font> <h6>
          <% }%>
          <div class="card mb-3">
           <div class="card-header">
             <i class="fa fa-table"></i> RESULTS</div>
           <div class="card-body">
             <div class="table-responsive">
               <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                 <thead>
                       <tr>
                         <% var newkeys= [] %>
                         <% if(result.length!= 0) newkeys = Object.keys(result[0]); %>
                         <% for(var i=0; i < newkeys.length; i++){ %>
                               <th><%= newkeys[i] %></th>
                         <% } %>
                       </tr>
                 </thead>
                 <tfoot>
                   <tr>
                     <% for(var i=0; i < newkeys.length; i++){ %>
                           <th><%= newkeys[i] %></th>
                     <% } %>
                   </tr>
                 </tfoot>
                 <tbody>
                   <% if(photos == true ){ %>
                      <% for(var i=0; i < result.length; i++) { %>
                            <% for(var k=0; k < result[i]["photos"].length; k++) { %>
                                <tr>
                                <% for(var j=0; j < newkeys.length; j++){ %>
                                      <% if(keys[j] == "photos"){ %>
                                            <td><%- result[i][newkeys[j]][k] %></td>
                                      <% }else{ %>
                                            <td><%= result[i][newkeys[j]] %></td>
                                      <% } %>
                                <% } %>
                               </tr>
                            <% } %>
                    <% } %>
                   <% } else { %>
                        <% for(var i=0; i < result.length; i++) { %>
                              <tr>
                              <% for(var j=0; j < newkeys.length; j++){ %>
                                    <td><%= result[i][newkeys[j]] %></td>
                              <% } %>
                             </tr>
                       <%} %>
                  <% } %>
                 </tbody>
               </table>
             </div>
           </div>
           <div class="card-footer small text-muted">We found <%= result.length %> results for your query.</div>
         </div>
         <form action="/json" method="post">
           <div class="col text-center">
               <button type="submit" class="btn btn-block btn-basic">Get JSON object</button>
           </div>
        </form>
        <br>
      <% }%>
      <script type="text/javascript">
       /*  window.onload = function () {
          var chart = new CanvasJS.Chart("chartContainer", {
          animationEnabled: true,
          axisX:{
          interval: 1
          },
          axisY2:{
          gridColor: "rgba(1,77,101,.1)",
          title: "Nationalites"
          },
          data: [{
          type: "bar",
          name: "companies",
          axisYType: "secondary",
          color: "#014D65",
          dataPoints: [
            { y: 3, label: "Sweden" },
            { y: 7, label: "Taiwan" },
            { y: 5, label: "Russia" },
            { y: 9, label: "Spain" }
          ]
          }]
          });
          chart.render();
      }*/
      /*
      var ctx=document.getElementById("myBarChart");
      var myLineChart=new Chart(ctx,
        {
          type:"bar",
          data:{
          labels:["January","February","March","April","May","June"],
          datasets:[
            {
              label:"Revenue",
              backgroundColor:"rgba(2,117,216,1)",
              borderColor:"rgba(2,117,216,1)",
              data:[4215,5312,6251,7841,9821,14984]
          }
         ]
        },
        options:{
          scales:{
            xAxes:[
              {
                time:{unit:"month"},
                gridLines:{display:!1},
                ticks:{maxTicksLimit:6}
              }
                ],
            yAxes:[
              {
                ticks:{min:0,max:15e3,maxTicksLimit:5},
                gridLines:{display:!0}
              }
            ]
        },
        legend:{display:!1}
        }
      }
      )
      */
      /*
      <!-- Example Bar Chart Card-->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fa fa-bar-chart"></i> Nationalities on Instagram in June 2014</div>
        <div class="card-body">
          <canvas id="myBarChart" width="100" height="50"></canvas>
        </div>
        <div class="card-footer small text-muted">DataViz of the query you asked for</div>
      </div>
      */
      </script>
    </div>
    <footer class="sticky-footer">
      <div class="container">
        <div class="text-center">
          <small>Copyright ¬© Abdellah Sabry 2017</small>
        </div>
      </div>
    </footer>
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top"> <i class="fa fa-angle-up"></i></a>
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <!-- Page level plugin JavaScript-->
    <script src="vendor/datatables/jquery.dataTables.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.js"></script>
    <!-- Custom scripts for all pages-->
    <script src="js/style.min.js"></script>
    <!-- Custom scripts for this page-->
    <script src="js/datatables.min.js"></script>
    <script src="vendor/chart.js/Chart.min.js"></script>
  </div>
</body>

</html>
